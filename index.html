<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrandRP - Code P√©nal</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        gaming: {
                            dark: '#0f172a',
                            card: '#1e293b',
                            accent: '#6366f1',
                            secondary: '#ec4899'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0f172a;
            background-image: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(236, 72, 153, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(99, 102, 241, 0.15) 0px, transparent 50%);
            background-attachment: fixed;
            color: #e2e8f0;
        }

        /* Glassmorphism Classes */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .glass-card {
            background: rgba(51, 65, 85, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            background: rgba(51, 65, 85, 0.6);
            transform: translateY(-2px);
            border-color: rgba(99, 102, 241, 0.4);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.3);
        }

        .glass-card.selected {
            background: rgba(99, 102, 241, 0.2);
            border-color: #6366f1;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }

        /* Utilities */
        .text-glow {
            text-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: white;
            color: #1e293b;
            padding: 12px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transform: translateY(150%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #toast.show { transform: translateY(0); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>

<body class="h-screen flex flex-col md:flex-row overflow-hidden text-sm md:text-base">
        <div id="toast">
        <i class="fas fa-check-circle text-green-500 text-xl"></i>
        <span id="toastMsg">Action effectu√©e !</span>
    </div>
    <!-- SIDEBAR (HUD) -->
    <aside class="w-full md:w-80 glass-panel flex flex-col z-20 md:h-full relative shrink-0">
        <!-- Header Sidebar -->
        <div class="p-6 border-b border-white/10 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/30">
                    <i class="fas fa-gavel text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg tracking-wide">Code P√©nal</h1>
                    <p class="text-xs text-slate-400">Outil d√©velopper par Jules Miton</p>
                </div>
            </div>
        </div>

        <!-- Scrollable Content Sidebar -->
        <div class="flex-1 overflow-y-auto p-6 space-y-6">
            
            <!-- Recherche -->
            <div class="relative group">
                <i class="fas fa-search absolute left-3 top-3.5 text-slate-400 group-focus-within:text-indigo-400 transition-colors"></i>
                <input type="text" id="searchInput" onkeyup="filterArticles()" placeholder="Rechercher infraction..." 
                    class="w-full bg-slate-800/50 border border-slate-700 rounded-xl py-3 pl-10 pr-4 text-slate-200 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all placeholder-slate-500">
            </div>

            <!-- Niveau de recherche -->
            <div>
                <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Statut Recherch√©</label>
                <select id="wantedStatus" onchange="calculateTotal()" class="w-full bg-slate-700 border-0 rounded-lg px-4 py-3 text-white text-sm focus:ring-2 focus:ring-indigo-500">
                        <option value="0">üîç Non recherch√©</option>
                        <option value="1">‚≠ê 1 √âtoile (15 mois)</option>
                        <option value="2">‚≠ê‚≠ê 2 √âtoiles (30 mois)</option>
                        <option value="3">‚≠ê‚≠ê‚≠ê 3 √âtoiles (45 mois)</option>
                        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê 4 √âtoiles (60 mois)</option>
                        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 √âtoiles (75 mois)</option>
                </select>
            </div>

            <!-- Calculateur Live -->
            <div class="bg-slate-800/50 rounded-2xl p-4 border border-slate-700/50 space-y-3">
                <div class="flex justify-between items-center">
                    <span class="text-slate-400">Articles s√©lectionn√©s </span>
                    <span id="countDisplay" class="bg-indigo-500/20 text-indigo-300 px-2 py-0.5 rounded text-xs font-bold">0</span>
                </div>
                <div class="h-px bg-slate-700/50"></div>
                <div class="flex justify-between items-center">
                    <span class="text-slate-400">Prison F√©d√©rale :</span>
                    <span id="prisonDisplay" class="font-bold text-red-400">0 mois</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-slate-400">Amende Totale :</span>
                    <span id="fineDisplay" class="font-bold text-emerald-400">$0</span>

            </div>
             <div class="flex justify-between items-center">
                <span class="text-slate-400">√âtoiles :</span>
                <span id="starsDisplay" class="text-yellow-400 text-lg tracking-wider"></span>
            </div>

            <div>
                <p class="text-slate-400 mb-1">Motif complet :</p>
                <p id="fullReasonDisplay" class="text-indigo-300 text-xs leading-relaxed">
                </p>
            </div>
        
            <div>
                <p class="text-slate-400 mb-1">Motif (articles) : </p>
                <p id="articlesOnlyDisplay" class="text-indigo-300 text-xs leading-relaxed">
                </p>
            </div>
            <div>
            <p class="text-slate-400 mb-1">Peine Suplementaire :</p>
            <ul id="sanctionsDisplay" class="text-yellow-400 text-xs leading-relaxed list-disc list-inside">
                </p>
            </ul>
            </div>
            <!-- Boutons d'action -->
            <div class="grid grid-cols-2 gap-3">
                <button onclick="resetAll()" class="py-3 rounded-xl bg-red-500 hover:bg-red-600 transition-all text-white font-medium">
                    <i class="fas fa-trash-alt"></i> Reset
                </button>
                <button onclick="copyDiscordReport()" class="py-3 rounded-xl bg-indigo-600 hover:bg-indigo-700 transition-all text-white font-medium">
                    <i class="fas fa-file-alt"></i> Rapport
                </button>
                <button onclick="openMirandaModal()" class="col-span-2 py-3 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold shadow-lg shadow-purple-500/20 hover:shadow-purple-500/40 hover:scale-[1.02] transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-microphone-alt"></i> G√âN√âRER MIRANDA
                </button>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto relative scroll-smooth p-4 md:p-8" id="mainContainer">
        
        <!-- Header Mobile Only -->
        <div class="md:hidden mb-6 flex items-center justify-between">
            <h2 class="text-xl font-bold">Code P√©nal</h2>
        </div>

        <!-- Container des articles (G√©n√©r√© par JS) -->
        <div id="articlesContainer" class="space-y-8 pb-20">
            <!-- Les sections seront inject√©es ici -->
        </div>

    </main>

    <!-- MODAL MIRANDA -->
    <div id="mirandaModal" class="fixed inset-0 z-50 hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeMirandaModal()"></div>
        
        <!-- Content -->
        <div class="absolute inset-0 flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-5xl shadow-2xl transform transition-all scale-100 flex flex-col max-h-[90vh]">

                <div class="p-6 border-b border-slate-700 flex justify-between items-center bg-slate-800/50 rounded-t-2xl">
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-file-contract text-yellow-500"></i> Droit Miranda & Arrestation
                    </h3>
                    <button onclick="closeMirandaModal()" class="text-slate-400 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="p-6 overflow-y-auto space-y-6">
                    <!-- Config -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs text-slate-400 mb-1">Votre Organisation</label>
                            <select id="orgSelect" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2 text-sm" onchange="generateMirandaText()">
                                <option value="LSPD">üöî LSPD - Los Santos Police Department</option>
                                <option value="FIB">üö® FIB - Federal Investigation Bureau</option>
                                <option value="GN">ü™ñ GN - National Guard</option>
                                <option value="SAHP">üõ£Ô∏è SAHP - San Andreas Highway Patrol </option>
                                <option value="Gouvernement">üèõÔ∏è Government - Government of Los Santos </option>
                            </select>
                        </div>
                    </div>

                    <!-- Preview Text -->
                    <div class="bg-black/50 rounded-xl p-4 border border-slate-700 relative group">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">Lecture √† voix haute</h4>
                        <p id="mirandaText" class="font-mono text-sm leading-relaxed text-indigo-200 whitespace-pre-wrap"></p>
                        <button onclick="copyToClipboard('mirandaText')" class="absolute top-2 right-2 bg-slate-700 hover:bg-indigo-600 text-white text-xs px-2 py-1 rounded transition-colors opacity-0 group-hover:opacity-100">
                            Copier
                        </button>
                </div>

                <div class="p-6 border-t border-slate-700 bg-slate-800/30 rounded-b-2xl flex justify-end gap-3">
                    <button onclick="closeMirandaModal()" class="px-4 py-2 text-slate-400 hover:text-white transition-colors">Fermer</button>
                    <button onclick="copyToClipboard('mirandaText')" class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 rounded-lg text-white font-medium shadow-lg shadow-indigo-500/20">
                        Copier le texte
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- DATA & LOGIC -->
    <script>
function calculateStars(prisonMonths) {
    return Math.min(5, Math.floor(prisonMonths / 15));


}

function updateReasons() {
    let fullReasons = [];
    let articleCodes = [];
    let sanctionsSet = new Set();

    selectedArticles.forEach(articleKey => {
        for (const section of Object.values(codePenal)) {
            if (section.articles[articleKey]) {
                const art = section.articles[articleKey];

                // Motifs
                fullReasons.push(art.name);
                articleCodes.push(articleKey);

                // Sanctions (extra)
                if (art.extra && art.extra.trim() !== "") {
                    // S√©parer si plusieurs sanctions dans le texte
                    art.extra.split("+").forEach(s => {
                        sanctionsSet.add(s.trim());
                    });
                }
            }
        }
    });

    // Motif complet
    document.getElementById('fullReasonDisplay').textContent =
        fullReasons.length ? fullReasons.join(', ') : '';

    // Motif articles
    document.getElementById('articlesOnlyDisplay').textContent =
        articleCodes.length ? articleCodes.join(', ') : '';

    // Sanctions
    const sanctionsDisplay = document.getElementById('sanctionsDisplay');
    sanctionsDisplay.innerHTML = '';

    if (sanctionsSet.size === 0) {
        sanctionsDisplay.innerHTML =
            ``;
    } else {
        sanctionsSet.forEach(sanction => {
            sanctionsDisplay.innerHTML += `<li>${sanction}</li>`;
        });
    }
}



        // --- DONN√âES DU CODE P√âNAL (Tel que fourni) ---
        const codePenal = {
            "1.1": {
                title: "D√©lit routier",
                icon: "fa-car",
                color: "text-emerald-400",
                bg: "bg-emerald-500/10",
                border: "border-emerald-500/30",
                articles: {
                "1.1.0": { name: "Klaxonnement abusif", fine: 10000, prison: 0, extra: "Mise en fourri√®re", detail: "Usage abusif du klaxon perturbant autrui.", code: "klaxon abusif" },
                "1.1.1.a": { name: "Abandon de V√©hicule", fine: 7500, prison: 0, extra: "Mise en fourri√®re", detail: "Abandon sur bord de route ou lieu priv√©.", code: "abandon vehicule" },
                "1.1.1.b": { name: "Stationnement inappropri√©", fine: 7500, prison: 0, extra: "Mise en fourri√®re", detail: "G√™ne la circulation.", code: "stationnement" },
                "1.1.2": { name: "Abandon Zone Sp√©ciale", fine: 20000, prison: 0, extra: "Mise en fourri√®re", detail: "Lieu r√©serv√© fonctionnaires √âtat.", code: "abandon zone speciale" },
                "1.1.3": { name: "Exc√®s Vitesse (1-30 km/h)", fine: 5000, prison: 0, extra: "", detail: "D√©passement de 1 √† 30 km/h.", code: "vitesse 1-30 kmh" },
                "1.1.4": { name: "Exc√®s Vitesse (30-60 km/h)", fine: 10000, prison: 0, extra: "Fourri√®re", detail: "D√©passement de 30 √† 60 km/h.", code: "vitesse 30-60 kmh" },
                "1.1.5": { name: "Exc√®s Vitesse (60-90 km/h)", fine: 15000, prison: 0, extra: "Fourri√®re + Retrait permis", detail: "D√©passement de 60 √† 90 km/h.", code: "vitesse 60-90 kmh" },
                "1.1.6": { name: "Non Port Plaque", fine: 10000, prison: 0, extra: "Fourri√®re", detail: "Pas de plaque conforme.", code: "sans plaque" },
                "1.1.7": { name: "Conduite dangereuse", fine: 20000, prison: 15, extra: "", detail: "Met en danger autrui.", code: "conduite dangereuse" },
                "1.1.8": { name: "Vol de V√©hicule", fine: 45000, prison: 45, extra: "", detail: "Vole ou tente de voler.", code: "vol vehicule" },
                "1.1.9": { name: "Conduite sous influence", fine: 20000, prison: 15, extra: "", detail: "Substances alt√©rant les capacit√©s.", code: "conduite sous influence" },
                "1.1.10": { name: "Course ill√©gale", fine: 20000, prison: 30, extra: "Retrait permis", detail: "Course non autoris√©e.", code: "course illegale" },
                }
            },
            "2.0": {
                title: "L√©gislation des Armes",
                icon: "fa-gun",
                color: "text-red-400",
                bg: "bg-red-500/10",
                border: "border-red-500/30",
                articles: {
                "2.0.1": { name: "Arme L√©gale sans PPA", fine: 20000, prison: 15, extra: "Confiscation", detail: "Arme avec s√©rie mais sans permis.", code: "arme sans ppa" },
                "2.0.2": { name: "Arme Ill√©gale (XXX)", fine: 20000, prison: 30, extra: "Confiscation + Retrait PPA", detail: "Pas de num√©ro de s√©rie.", code: "arme illegale xxx" },
                "2.0.21": { name: "Arme tranchante", fine: 10000, prison: 0, extra: "Confiscation + Retrait PPA", detail: "Couteau, dague, etc.", code: "arme tranchante" },
                "2.0.3": { name: "Mat√©riel d'√âtat", fine: 20000, prison: 45, extra: "Confiscation + Retrait PPA", detail: "Gilet, taser, arme police.", code: "materiel etat" },
                "2.0.4": { name: "Gilet Pare-Balles Teint√©", fine: 10000, prison: 15, extra: "Confiscation + Retrait PPA", detail: "Tout sauf noir ammu.", code: "gilet colore" },
                "2.0.5": { name: "Vente/Achat Armes Ill√©gal", fine: 30000, prison: 45, extra: "Confiscation + Retrait PPA", detail: "Lieu public ou priv√©.", code: "vente armes illegales" },
                "2.0.6": { name: "Brandissement Public", fine: 20000, prison: 15, extra: "Confiscation + Retrait PPA", detail: "Sans raison valable.", code: "brandissement public" },
                "2.0.7": { name: "D√©charge Sans Raison", fine: 30000, prison: 30, extra: "Confiscation + Retrait PPA", detail: "Tirer sans raison l√©gale.", code: "decharge arme" },
                "2.0.8": { name: "Arme par destination", fine: 20000, prison: 0, extra: "Confiscation + Retrait PPA", detail: "Batte, club de golf utilis√© de mani√®re mena√ßante.", code: "arme par destination" },
                }
            },
            "3.0": {
                title: "Stup√©fiants & Contrebande",
                icon: "fa-cannabis",
                color: "text-amber-400",
                bg: "bg-amber-500/10",
                border: "border-amber-500/30",
                articles: {
                "3.0.0.a": { name: "Plantation cannabis (2-3 plantes)", fine: 10000, prison: 0, extra: "Destruction des plantes", detail: "Petite √©chelle.", code: "plantation cannabis 2-3" },
                "3.0.0.b": { name: "Plantation cannabis (4+ plantes)", fine: 20000, prison: 30, extra: "Destruction des plantes", detail: "Grande √©chelle.", code: "plantation cannabis 4+" },
                "3.0.1": { name: "Possession Substances (1-10)", fine: 8000, prison: 0, extra: "Confiscation", detail: "Petite quantit√©.", code: "substances 1-10" },
                "3.0.2": { name: "Possession Substances (11-20)", fine: 12000, prison: 0, extra: "Confiscation", detail: "Quantit√© mod√©r√©e.", code: "substances 11-20" },
                "3.0.3": { name: "Possession Substances (21+)", fine: 25000, prison: 30, extra: "Confiscation", detail: "Grande quantit√©.", code: "substances 21+" },
                "3.0.4": { name: "Trafic de Substances", fine: 35000, prison: 45, extra: "Confiscation", detail: "Intention de distribuer.", code: "traffic substances" },
                "3.0.5": { name: "Usage Substances", fine: 5000, prison: 0, extra: "Confiscation", detail: "Sauf cannabis.", code: "usage substances" },
                "3.0.6": { name: "Intoxication Publique", fine: 5000, prison: 0, extra: "Cellule d√©grisement", detail: "Risque pour soi ou autrui.", code: "intoxication publique" },
                "3.0.7": { name: "Possession Articles Interdits", fine: 15000, prison: 0, extra: "Confiscation", detail: "Objets interdits √† la vente.", code: "articles interdits" },
                "3.0.8": { name: "Trafic Objets Interdits", fine: 30000, prison: 30, extra: "Confiscation", detail: "Intention de distribuer.", code: "traffic objets interdits" },
                }
            },
            "4.0": {
                title: "Crimes contre les Personnes",
                icon: "fa-user-shield",
                color: "text-indigo-400",
                bg: "bg-indigo-500/10",
                border: "border-indigo-500/30",
                articles: {
                "4.0.0": { name: "Outrage a agent", fine: 10000, prison: 15, extra: "Mise en garde √† vue", detail: "Insultes ou propos d√©gradants envers un repr√©sentant des FDO.", code: "outrage agent" },
                "4.0.1.a": { name: "Se faire Passer pour un Fonctionnaire", fine: 40000, prison: 75, extra: "Confiscation Armes + Retrait PPA", detail: "S'habiller, badge, ou pr√©tendre √™tre agent.", code: "faux fonctionnaire" },
                "4.0.1.b": { name: "Utilisation ill√©gale de signaux d'urgence", fine: 20000, prison: 15, extra: "", detail: "Usage de gyrophares/sir√®nes r√©serv√©s FDO.", code: "signaux urgence" },
                "4.0.2": { name: "Entrave √† la Justice", fine: 20000, prison: 45, extra: "", detail: "Obstruer le travail des policiers ou magistrats.", code: "entrave justice" },
                "4.0.2.1": { name: "Intimidation t√©moin", fine: 30000, prison: 60, extra: "Retrait PPA", detail: "Pressions ou menaces sur un t√©moin.", code: "intimidation temoin" },
                "4.0.3": { name: "Agression par la Menace", fine: 15000, prison: 30, extra: "Confiscation Armes + Retrait PPA", detail: "Menaces d'agression physique ou morale.", code: "menaces agression" },
                "4.0.3.b": { name: "Incitation √† la haine ou violence", fine: 25000, prison: 45, extra: "Retrait PPA", detail: "Propos appelant √† la haine ou discrimination.", code: "incitation haine" },
                "4.0.4": { name: "√âmeute", fine: 10000, prison: 45, extra: "", detail: "Soul√®vement populaire non autoris√©.", code: "emeute" },
                "4.0.4.bis": { name: "Manifestation ill√©gale", fine: 20000, prison: 30, extra: "", detail: "Rassemblement sur voie publique sans autorisation.", code: "manifestation illegale" },
                "4.0.5": { name: "Tentative d'Evasion / Evasion", fine: 30000, prison: 75, extra: "Sans Possibilit√© de Caution", detail: "S'√©chapper d'un lieu d'enfermement.", code: "evasion" },
                "4.0.6": { name: "Trouble √† l'Ordre Public", fine: 20000, prison: 15, extra: "", detail: "Atteinte significative √† la paix publique.", code: "trouble ordre public" },
                "4.0.7": { name: "Coups et Blessures sur Citoyen", fine: 15000, prison: 30, extra: "", detail: "Violences intentionnelles sur civil.", code: "violence citoyen" },
                "4.0.8": { name: "Coups et Blessures sur Agent FDO", fine: 20000, prison: 45, extra: "", detail: "Violences intentionnelles sur agent.", code: "violence agent fdo" },
                "4.0.9": { name: "Insubordination (Agent Etat)", fine: 15000, prison: 45, extra: "Licenciement + Blacklist min. 3J", detail: "Remise en cause d'un ordre sup√©rieur.", code: "insubordination agent" },
                "4.0.10": { name: "Diffamation publique", fine: 10000, prison: 15, extra: "", detail: "Propos mensongers portant atteinte √† l'honneur.", code: "diffamation" },
                "4.1.0.a": { name: "Violation de la Vie Priv√©e", fine: 10000, prison: 30, extra: "", detail: "Partage de parties intimes sans consentement.", code: "violation vie privee" },
                "4.1.0.b": { name: "Atteinte √† la dignit√©", fine: 10000, prison: 15, extra: "", detail: "Acte portant atteinte √† l'int√©grit√© ou dignit√©.", code: "atteinte dignite" },
                "4.1.1": { name: "Propagation de Maladie", fine: 6000, prison: 0, extra: "", detail: "Propager intentionnellement une maladie.", code: "propagation maladie" },
                "4.1.2.a": { name: "Refus d'Identification", fine: 10000, prison: 15, extra: "", detail: "Refus de donner ses papiers lors d'un contr√¥le.", code: "refus identification" },
                "4.1.2.b": { name: "D√©lit de faci√®s (Agent Etat)", fine: 10000, prison: 0, extra: "Licenciement + Blacklist min. 7J", detail: "Contr√¥le discriminatoire.", code: "delit facies" },
                "4.1.2.1.a": { name: "Chantage", fine: 20000, prison: 45, extra: "", detail: "Menacer de r√©v√©ler des faits pour obtenir un bien.", code: "chantage" },
                "4.1.2.1.b": { name: "Ex√©cution du Chantage", fine: 35000, prison: 45, extra: "", detail: "Divulgation des infos suite au chantage.", code: "execution chantage" },
                "4.1.3": { name: "Refus d'obtemp√©rer", fine: 20000, prison: 45, extra: "Sans Possibilit√© de Caution", detail: "Refuser d'ob√©ir √† un ordre fonctionnaire.", code: "refus obtemperer" },
                "4.1.3.1": { name: "Non-respect d√©cision judiciaire", fine: 30000, prison: 60, extra: "", detail: "Interdiction contact, pointage, etc.", code: "non respect judiciaire" },
                "4.1.4": { name: "Fausses D√©clarations", fine: 15000, prison: 15, extra: "", detail: "Mentir lors d'un interrogatoire.", code: "fausses declarations" },
                "4.1.5": { name: "Intrusion", fine: 10000, prison: 30, extra: "45 mois si b√¢timent √âtat", detail: "S'introduire sans droit en propri√©t√© priv√©e.", code: "intrusion" },
                "4.1.6": { name: "Agent d'Etat Corrompu", fine: 45000, prison: 60, extra: "Licenciement + Blacklist 30J", detail: "Se faire r√©mun√©rer pour un acte officiel.", code: "agent corrompu" },
                "4.1.7": { name: "Non-Paiement Contraventions", fine: 0, prison: 45, extra: "R√©vocation licences + Sans Caution", detail: "Seuil de 500,000$ impay√© atteint.", code: "contraventions impayees" },
                "4.1.8": { name: "Port de masque", fine: 0, prison: 0, extra: "Motif de contr√¥le et fouille", detail: "Porter un masque en lieu public.", code: "port masque" },
                "4.1.9": { name: "Ev√©nement Dangereux non encadr√©", fine: 20000, prison: 0, extra: "", detail: "Sans 1 EMS et 1 Agent √âtat.", code: "evenement dangereux" },
                "4.2.0": { name: "Cambriolage", fine: 30000, prison: 45, extra: "Possibilit√© de Caution", detail: "Vol en habitation par effraction.", code: "cambriolage" },
                "4.2.1": { name: "Extorsion", fine: 15000, prison: 45, extra: "Confiscation Armes + Retrait PPA", detail: "Obtenir signature/bien par violence/menace.", code: "extorsion" },
                "4.2.2": { name: "Falsification Document", fine: 45000, prison: 60, extra: "", detail: "Modifier licences, contrats ou documents.", code: "falsification document" },
                "4.2.2.b": { name: "Usurpation d'identit√©", fine: 15000, prison: 30, extra: "", detail: "Se faire passer pour une autre personne.", code: "usurpation identite" },
                "4.2.3": { name: "Vol Qualifi√©", fine: 15000, prison: 45, extra: "Confiscation Armes + Retrait PPA", detail: "Vol avec violence ou arme.", code: "vol qualifie" },
                "4.2.4": { name: "Chasse ou p√™che ill√©gale", fine: 20000, prison: 0, extra: "Confiscation + Retrait PPA", detail: "Braconnage sans rel√¢chement.", code: "braconnage" },
                "4.2.5": { name: "Corrompre un Fonctionnaire", fine: 45000, prison: 60, extra: "", detail: "Offre ou promesse √† un agent.", code: "corruption fonctionnaire" },
                "4.2.6.a": { name: "Mise en danger d'autrui", fine: 30000, prison: 45, extra: "", detail: "Exposition volontaire √† un risque de mort.", code: "mise en danger" },
                "4.2.6.b": { name: "Non-Assistance √† Personne", fine: 10000, prison: 30, extra: "", detail: "Abandonner quelqu'un en danger de mort.", code: "non assistance" },
                "4.2.7": { name: "Lib√©ration Caution Ill√©gale", fine: 50000, prison: 60, extra: "Retrait Licences Avocat + PPA", detail: "Lib√©rer sans approbation Gouvernement.", code: "liberation sans autorisation" },
                "4.2.8": { name: "Refus du Devoir d'Agir", fine: 20000, prison: 45, extra: "Licenciement + Blacklist min. 7J", detail: "Agent ne respectant pas son devoir.", code: "refus devoir agent" },
                "4.2.9": { name: "Cr√©ation Communaut√© Ill√©gale", fine: 30000, prison: 60, extra: "Confiscation Armes + Retrait PPA", detail: "Groupe pour actes r√©pr√©hensibles.", code: "creation groupe illegal" },
                "4.2.9.1": { name: "Recrutement Criminel", fine: 50000, prison: 75, extra: "Retrait PPA + Sans Caution", detail: "Recruter pour grand banditisme.", code: "recrutement criminel" },
                "4.3.0": { name: "Grand Banditisme", fine: 20000, prison: 60, extra: "Confiscation Armes + Retrait PPA", detail: "Participation √† un groupe criminel actif.", code: "grand banditisme" },
                "4.3.1": { name: "Direction Groupe Ill√©gal", fine: 30000, prison: 60, extra: "Confiscation Armes + Retrait PPA", detail: "Diriger un groupe criminel.", code: "direction groupe illegal" },
                "4.3.2": { name: "Prise d'Otage Fonctionnaire", fine: 40000, prison: 75, extra: "Retrait PPA + Sans Caution", detail: "D√©tention ill√©gale d'un agent √âtat.", code: "otage fonctionnaire" },
                "4.3.3": { name: "Prise d'Otage Civil", fine: 30000, prison: 60, extra: "Retrait PPA + Sans Caution", detail: "D√©tention ill√©gale d'un civil.", code: "otage civil" },
                "4.3.4": { name: "Homicide Involontaire", fine: 10000, prison: 30, extra: "Retrait PPA", detail: "Causer la mort sans intention sp√©cifique.", code: "homicide involontaire" },
                "4.3.5": { name: "Meurtre / Tentative", fine: 30000, prison: 60, extra: "Retrait PPA + Sans Caution", detail: "Attenter √† la vie d'une personne.", code: "meurtre" },
                "4.3.7": { name: "Meurtre avec Pr√©m√©ditation", fine: 40000, prison: 75, extra: "Retrait PPA + Sans Caution", detail: "Planifier l'acte d'attenter √† la vie.", code: "meurtre premedite" },
                }
            },
            "5.0": {
                title : "Atteinte √† la Nation",
                color: "from-purple-600 to-violet-600",
                icon: "fas fa-flag",
                articles: {
                "5.0.1": { name: "Tentative de Coup d'√âtat", fine: 50000, prison: 75, extra: "Retrait Licences + Sans Caution", detail: "Renversement ill√©gal du pouvoir par la force.", code: "coup etat" },
                "5.0.2": { name: "Divulgation de Secret d'√âtat", fine: 50000, prison: 75, extra: "Retrait Licences + Sans Caution", detail: "Divulgation d'informations confidentielles strat√©giques.", code: "secret etat" },
                "5.0.3": { name: "Terrorisme", fine: 50000, prison: 75, extra: "Retrait Licences + Sans Caution", detail: "Emploi de la terreur √† des fins id√©ologiques ou politiques.", code: "terrorisme" },
                "5.0.4": { name: "Recrutement Terroriste", fine: 50000, prison: 75, extra: "Retrait Licences + Sans Caution", detail: "Appel au recrutement pour actes terroristes.", code: "recrutement terrorisme" },
                "5.0.6": { name: "Attaque Base Militaire", fine: 50000, prison: 75, extra: "Retrait Licences + Sans Caution", detail: "Intrusion et attaque du personnel militaire pour vol.", code: "attaque base militaire" },
                "5.0.7": { name: "Attentat contre Institutions", fine: 50000, prison: 75, extra: "Retrait Licences + Sans Caution", detail: "Atteinte aux int√©r√™ts fondamentaux de la nation.", code: "attentat institutions" },
                "5.0.8": { name: "Mouvement Insurrectionnel", fine: 50000, prison: 75, extra: "Retrait Licences + Sans Caution", detail: "Action de r√©bellion visant √† renverser le pouvoir.", code: "insurrection" }}
            }
        }

        // --- STATE MANAGEMENT ---
        let selectedArticles = new Set();
        let currentSearch = "";

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderArticles();
        });

        // --- RENDER LOGIC ---
        function renderArticles() {
            const container = document.getElementById('articlesContainer');
            container.innerHTML = '';

            for (const [sectionKey, section] of Object.entries(codePenal)) {
                // Filter logic
                const sectionArticles = Object.entries(section.articles);
                const filteredArticles = sectionArticles.filter(([key, art]) => {
                    const search = currentSearch.toLowerCase();
                    return art.name.toLowerCase().includes(search) || 
                           art.code.toLowerCase().includes(search) || 
                           key.includes(search);
                });

                if (filteredArticles.length === 0) continue;

                // Create Section Header
                const sectionHtml = document.createElement('div');
                sectionHtml.className = 'animate-fade-in';
                
                let cardsHtml = '';
                filteredArticles.forEach(([key, art]) => {
                    const isSelected = selectedArticles.has(key);
                    const selectedClass = isSelected ? 'selected ring-2 ring-indigo-500 bg-indigo-500/10' : '';
                    const iconCheck = isSelected ? '<i class="fas fa-check-circle text-indigo-400 text-xl"></i>' : '<i class="far fa-circle text-slate-600 text-xl group-hover:text-indigo-400 transition-colors"></i>';
                    
                    cardsHtml += `
                        <div onclick="toggleArticle('${key}')" 
                             class="glass-card cursor-pointer rounded-2xl p-4 relative group select-none ${selectedClass}">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-mono text-slate-500 bg-slate-800 px-2 py-0.5 rounded">${key}</span>
                                ${iconCheck}
                            </div>
                            <h4 class="font-bold text-slate-200 mb-1 group-hover:text-white transition-colors">${art.name}</h4>
                            <p class="text-xs text-slate-400 line-clamp-2 mb-3 h-8">${art.detail || "Pas de description d√©taill√©e."}</p>
                            
                            <div class="flex gap-2 text-xs font-semibold">
                                <div class="bg-slate-900/80 px-2 py-1 rounded text-emerald-400 border border-emerald-500/20">
                                    $${art.fine.toLocaleString()}
                                </div>
                                <div class="bg-slate-900/80 px-2 py-1 rounded text-red-400 border border-red-500/20">
                                    ${art.prison > 0 ? art.prison + ' mois' : 'Sans prison'}
                                </div>
                            </div>
                            ${art.extra ? `<div class="mt-2 text-[10px] text-amber-300 font-mono"><i class="fas fa-exclamation-triangle mr-1"></i>${art.extra}</div>` : ''}
                        </div>
                    `;
                });

                sectionHtml.innerHTML = `
                    <div class="flex items-center gap-3 mb-4 sticky top-0 z-10 py-2 backdrop-blur-sm bg-slate-900/80 md:bg-transparent md:backdrop-blur-none rounded-xl">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center ${section.bg} ${section.color}">
                            <i class="fas ${section.icon}"></i>
                        </div>
                        <h3 class="text-lg font-bold text-slate-200">${section.title}</h3>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        ${cardsHtml}
                    </div>
                `;
                
                container.appendChild(sectionHtml);
            }
        }

        // --- INTERACTION LOGIC ---
        function toggleArticle(key) {
            if (selectedArticles.has(key)) {
                selectedArticles.delete(key);
            } else {
                selectedArticles.add(key);
            }
            renderArticles(); 
            calculateTotal();
        }

        function filterArticles() {
            currentSearch = document.getElementById('searchInput').value;
            renderArticles();
        }

function calculateTotal() {
    let totalFine = 0;
    let totalPrison = 0;

    const wantedLevel = parseInt(document.getElementById('wantedStatus').value);

    // Prison li√©e aux √©toiles de recherche
    totalPrison += wantedLevel * 15;

    // Articles s√©lectionn√©s
    selectedArticles.forEach(key => {
        for (const section of Object.values(codePenal)) {
            if (section.articles[key]) {
                totalFine += section.articles[key].fine;
                totalPrison += section.articles[key].prison;
                break;
            }
        }
    });

    // PLAFONDS
    const MAX_FINE = 50000;
    const MAX_PRISON = 75;

    totalFine = Math.min(totalFine, MAX_FINE);
    totalPrison = Math.min(totalPrison, MAX_PRISON);

    // ‚≠ê CALCUL DES √âTOILES (APR√àS le calcul prison)
    const stars = calculateStars(totalPrison);
    document.getElementById('starsDisplay').textContent = renderStars(stars);


    // HUD
    animateValue("fineDisplay", totalFine, "$");
    document.getElementById('prisonDisplay').textContent = totalPrison + " mois";
    document.getElementById('countDisplay').textContent = selectedArticles.size;

    updateReasons();
}
function renderStars(stars) {
    const maxStars = 5;
    let output = "";

    for (let i = 1; i <= maxStars; i++) {
        output += i <= stars ? "‚≠ê" : "";
    }

    return output;
}



        // FONCTION RESET MODIFI√âE
        function resetAll() {
            showToast("R√©initialisation effectu√©e");
            selectedArticles.clear();
            document.getElementById('wantedStatus').value = 0;
            document.getElementById('searchInput').value = "";
            
            // On rafra√Æchit l'affichage (si tes fonctions existent)
            if (window.renderArticles) renderArticles();
            if (window.calculateTotal) calculateTotal();
            
            // ON AFFICHE LA NOTIF

        }
// --- MIRANDA & REPORT LOGIC ---

/**
 * Ouvre la modale Miranda
 * Ajout d'un toast si aucun article n'est s√©lectionn√©
 */
function openMirandaModal() {
    if (selectedArticles.size === 0) {
        showToast("S√©lectionnez des articles d'abord !");
        return; 
    }

    document.getElementById('mirandaModal').classList.remove('hidden');
    generateMirandaText();
    showToast("Droits Miranda g√©n√©r√©s !");
}

function closeMirandaModal() {
    document.getElementById('mirandaModal').classList.add('hidden');
}

/**
 * G√©n√®re le texte complet des droits Miranda
 */
function generateMirandaText() {
    const org = document.getElementById('orgSelect').value;
    let charges = [];
    let totalFine = 0;
    let totalPrison = parseInt(document.getElementById('wantedStatus').value) * 15;

    // On parcourt les articles s√©lectionn√©s pour calculer les peines
    selectedArticles.forEach(key => {
        for (const section of Object.values(codePenal)) {
            if (section.articles[key]) {
                charges.push(section.articles[key].name);
                totalFine += section.articles[key].fine;
                totalPrison += section.articles[key].prison;
            }
        }
    });

    const now = new Date();
    const date = now.toLocaleDateString('fr-FR');
    const heure = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });

    // Mod√®le de texte
    const text = `MADAME, MONSIEUR,

Vous √™tes actuellement en √©tat d'arrestation pour ${charges.length > 0 ? charges.join(", ") : "infractions diverses"}, par le ${org}.

Nous sommes le : ${date} √† ${heure}.

Vous avez le droit de garder le silence. Si vous renoncez √† ce droit, tout ce que vous direz pourra √™tre et sera utilis√© contre vous devant une cour de justice. Vous avez le droit √† un avocat et √† ce qu'un avocat soit pr√©sent lors de l'interrogatoire. Si vous n'en avez pas les moyens, un avocat vous sera fourni gratuitement.

Durant chaque interrogatoire, vous pouvez d√©cider √† tout moment d'exercer ces droits, de ne r√©pondre √† aucune question ou de ne faire aucune d√©position.

Vous avez √©galement le droit de recevoir des soins m√©dicaux, de manger et de boire.

Avez-vous compris vos droits ?

( Si la personne ne r√©pond pas, ou ne comprend pas, vous devez lui r√©p√©ter 3 fois ces droits. VOUS devez avoir une bodycam allum√©e. )`;

    document.getElementById('mirandaText').textContent = text;
}
function copyDiscordReport() {
    const source = document.getElementById("fullReasonDisplay");

    if (!source || source.textContent.trim() === "") {
        showToast("Aucun motif √† copier", true);
        return;
    }

    let text = source.textContent;

    text = text
        .replace(/,/g, " + ")
        .replace(/'/g, "")
        .replace(/√™/g, "e")
        .replace(/\s*\+\s*/g, " + ")
        .trim();

    navigator.clipboard.writeText(text);
    showToast("Rapport copi√© dans le presse-papier");
}



        // --- UTILS ---
        function animateValue(id, end, prefix = "") {
            const obj = document.getElementById(id);
            const current = parseInt(obj.textContent.replace(/[^0-9]/g, '')) || 0;
            if (current === end) return;
            
            obj.textContent = prefix + end.toLocaleString();
            // Simple visual bump
            obj.classList.remove('text-glow');
            void obj.offsetWidth; // trigger reflow
            obj.classList.add('text-glow');
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            copyToClipboardText(text);
        }

        function copyToClipboardText(text) {
            navigator.clipboard.writeText(text).then(() => { });
            showToast("Texte copi√© !");
        }
        function showToast(message) {
            var toast = document.getElementById("toast");
            var toastMsg = document.getElementById("toastMsg");
            var toastIcon = toast.querySelector("i");

            // Liste des messages qui doivent afficher un triangle jaune (Attention)
            var warningMessages = [
                "Aucun motif √† copier",
                "S√©lectionnez des articles d'abord !"
            ];

            // Mise √† jour du texte
            toastMsg.innerText = message;

            // V√©rification : Est-ce que le message est dans notre liste d'avertissements ?
            if (warningMessages.includes(message)) {
                // CAS ATTENTION : Triangle jaune
                toastIcon.className = "fas fa-exclamation-triangle text-yellow-500 text-xl";
            } else {
                // CAS SUCC√àS (par d√©faut) : Check vert
                toastIcon.className = "fas fa-check-circle text-green-500 text-xl";
            }

            // Afficher le toast
            toast.classList.add("show");

            // Le cacher apr√®s 3 secondes
            setTimeout(function() {
                toast.classList.remove("show");
            }, 3000);
        }
    </script>
</div>

</body>
<!-- FIXED FOOTER -->
<footer class="fixed bottom-0 left-0 w-full bg-[#050b18]/90 backdrop-blur border-t border-white/5 py-3 text-center text-xs text-slate-400">
    <p>
        Fait par <strong>Jules Miton</strong> ‚Äî Projet communautaire,
        <span class="text-slate-500">non affili√© √† Grand RP</span>
    </p>
</footer>
</html>
